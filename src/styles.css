/* =========================================================
   School OS — Compact UI (wide widgets, thin grid, readable)
   Expects theme.js -> applyTheme(theme, mode) to set:
   --bg-grad, --panel, --panel-border, --accent, --widget-tint
   ========================================================= */

/* ---------- Root ---------- */
:root{
  --bg-grad: linear-gradient(135deg,#eaf5ff,#d8ecff 45%,#c9e4ff);
  --panel: rgba(255,255,255,.55);
  --panel-border: rgba(0,0,0,.08);
  --accent:#0ea5e9;
  --widget-tint:#eaf5ff; /* theme supplies this to keep widgets/buttons on-brand */

  --text: #0f172a;
  --muted:#64748b;

  --radius:14px;
  --glass-blur:10px;

  --touch: 44px;
  --sidebar-w: 180px;     /* wider: icon + label */
  --content-max: 1600px;
}
:root.dark{
  --text: #e5e7eb;
  --muted:#94a3b8;
}

/* ---------- Base ---------- */
*{ box-sizing: border-box; }
html, body, #root{ height:100%; }
html{ -webkit-text-size-adjust: 100%; }
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  color: var(--text);
  background: var(--bg-grad);
}
a{ color: var(--accent); text-decoration:none; }
img{ max-width:100%; display:block; }
small,.small{ color: var(--muted); font-size:.86rem; }

/* ---------- Layout ---------- */
.container{
  max-width: var(--content-max);
  margin:0 auto;
  padding: calc(env(safe-area-inset-top) + 10px) 12px calc(env(safe-area-inset-bottom) + 12px);
}
.topbar{
  display:flex; align-items:center; justify-content:space-between;
  padding: 8px 12px; border-radius: var(--radius);
}
.layout{
  display:grid;
  grid-template-columns: var(--sidebar-w) minmax(0,1fr);
  gap: 12px;
}

/* ---------- Glass ---------- */
.glass{
  backdrop-filter: blur(var(--glass-blur));
  background: var(--panel);
  border:1px solid var(--panel-border);
  border-radius: var(--radius);
  color: var(--text);
}
.card{ padding: 10px; border-radius: var(--radius); }

/* ---------- Controls ---------- */
.btn{
  appearance:none; cursor:pointer;
  border:1px solid var(--panel-border);
  background: color-mix(in srgb, var(--widget-tint) 60%, white 40%);
  color: var(--text);
  min-height: var(--touch);
  padding: 6px 10px; border-radius: 12px;
}
:root.dark .btn{
  background: color-mix(in srgb, var(--widget-tint) 28%, black 72%);
}
.btn:hover{ filter: brightness(1.03); }
.btn:active{ transform: translateY(1px); }
.btn.xs{ min-height: 30px; padding: 4px 8px; border-radius: 10px; }

.btn.btn-primary{
  background: var(--accent);
  border-color: color-mix(in srgb, var(--accent) 60%, black 0%);
  color:#fff;
}
.btn.btn-ghost{ background: transparent; border-color: transparent; }

.input{
  width:100%; min-height: var(--touch);
  padding: 6px 9px; border-radius: 12px;
  border:1px solid var(--panel-border);
  background: color-mix(in srgb, var(--widget-tint) 65%, white 35%);
  color: var(--text);
}
:root.dark .input{
  background: color-mix(in srgb, var(--widget-tint) 26%, black 74%);
  color: var(--text);
}
.input.xs{ min-height: 30px; padding: 4px 8px; }
label.small{ display:block; margin:0 0 4px 2px; color: var(--muted); }

/* ---------- Sidebar (wider; 1 icon + text) ---------- */
.sidebarNav{
  position: sticky; top:8px; align-self:start; height:fit-content;
  width: var(--sidebar-w); overflow: clip;
  padding: 8px; display:flex; flex-direction:column; gap:8px;
}
.sidebarNav .brand{
  padding: 8px; border-radius: 12px;
  display:flex; align-items:center; justify-content:space-between;
}
.sidebarNav .brand .title{ font-weight:700; font-size:.98rem; }
.sidebarNav .brand .subtitle{ opacity:.78; font-size:.78rem; }

.sidebarNav .nav{ display:flex; flex-direction:column; gap:6px; }
.sidebarNav .nav .navItem{
  display:grid;
  grid-template-columns: 26px 1fr; /* icon | label */
  align-items:center; gap:8px;
  padding: 9px; min-height: 40px;
  border-radius: 12px; text-align:left; user-select:none;
  cursor:pointer;
  border:1px solid var(--panel-border);
  background: color-mix(in srgb, var(--widget-tint) 58%, white 42%);
  backdrop-filter: blur(8px);
  color: var(--text);
}
:root.dark .sidebarNav .nav .navItem{
  background: color-mix(in srgb, var(--widget-tint) 24%, black 76%);
  border-color: rgba(255,255,255,.12);
}
.sidebarNav .nav .navItem.active{
  border-color: color-mix(in srgb, var(--accent) 40%, transparent);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 18%, transparent) inset;
}
.navIcon{ font-size: 1.15rem; line-height:1; }
.navLabel{ font-size:.85rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

/* ---------- Widgets (compact; 1-screen feel) ---------- */
.widgetsArea{ position:relative; overflow:hidden; }
.widgetsGrid{
  display:grid; gap:10px;
  grid-template-columns: repeat(12, minmax(0,1fr));
}
.widgetWrap{
  border-radius: var(--radius); overflow:hidden; position:relative;
  background: color-mix(in srgb, var(--widget-tint) 60%, white 40%);
  border:1px solid var(--panel-border);
}
:root.dark .widgetWrap{
  background: color-mix(in srgb, var(--widget-tint) 26%, black 74%);
  border-color: rgba(255,255,255,.12);
}

/* Sizes: S = half, L = full */
.widget-size-s{ grid-column: span 6; }
.widget-size-l{ grid-column: span 12; }

/* Slim toolbar */
.widgetToolbar{
  position:absolute; top:6px; right:6px; z-index:20;
  display:flex; gap:6px; align-items:center; padding:3px 6px;
  border-radius:12px; backdrop-filter: blur(8px);
  background: rgba(255,255,255,.6); border:1px solid var(--panel-border);
  color: var(--text);
}
:root.dark .widgetToolbar{ background: rgba(20,20,25,.55); border-color: rgba(255,255,255,.12); }

/* Compact body */
.widgetBody{ padding: 38px 10px 10px; }

/* Fine grid overlay (only inside widgets area while dragging) */
.fineGrid{
  position:absolute; inset:0; border-radius: var(--radius);
  background-image:
    linear-gradient(to right, rgba(0,0,0,.07) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(0,0,0,.07) 1px, transparent 1px);
  background-size: 14px 14px, 14px 14px;
  pointer-events:none;
}

/* Sortable visuals */
.drag-ghost{ opacity:.66; }
.drag-fallback{ opacity:.97; transform: scale(1.01); }

/* Ultra-light drag pulse (only the chosen item) */
@keyframes pulseZ {
  0%   { transform: perspective(800px) translateZ(0) scale(1); }
  50%  { transform: perspective(800px) translateZ(10px) scale(1.003); }
  100% { transform: perspective(800px) translateZ(0) scale(1); }
}
.draggingPulseSoft{ animation: pulseZ 1300ms ease-in-out infinite; }

/* ---------- Lists inside widgets ---------- */
.list{ display:flex; flex-direction:column; gap:8px; }
.list .item{
  padding:8px; border-radius:12px; border:1px solid var(--panel-border);
  background: color-mix(in srgb, var(--widget-tint) 62%, white 38%);
  color: var(--text);
}
:root.dark .list .item{
  background: color-mix(in srgb, var(--widget-tint) 28%, black 72%);
  border-color: rgba(255,255,255,.12);
}

/* ---------- Badge ---------- */
.badge{
  display:inline-flex; align-items:center; gap:6px;
  padding: 3px 8px; border-radius: 999px; font-size:.78rem;
  background: color-mix(in srgb, var(--accent) 16%, transparent);
  border: 1px solid color-mix(in srgb, var(--accent) 38%, transparent);
  color: var(--text);
}

/* ---------- Lunch grid ---------- */
.lunchGrid{
  display:grid; gap:10px;
  grid-template-columns: repeat(4, minmax(0,1fr));
}
@media (max-width: 1400px){ .lunchGrid{ grid-template-columns: repeat(3,1fr); } }
@media (max-width: 980px){  .lunchGrid{ grid-template-columns: repeat(2,1fr); } }
@media (max-width: 640px){  .lunchGrid{ grid-template-columns: 1fr; } }
.lunchCard{ border-radius: var(--radius); overflow:hidden; padding:0; }
.lunchImgWrap{ position:relative; width:100%; height:160px; overflow:hidden; }
.lunchImg{ width:100%; height:100%; object-fit:cover; display:block; }
.lunchImg.placeholder{
  display:flex; align-items:center; justify-content:center;
  background:linear-gradient(135deg,#e5e7eb,#f3f4f6); color:#6b7280; font-size:.9rem;
}
.favBtn{
  position:absolute; top:8px; right:8px; border:none; border-radius:999px;
  background: rgba(0,0,0,.35); color:#fff; padding:6px 10px; cursor:pointer;
}

/* ---------- Profile ---------- */
.avatarBox{ display:flex; align-items:center; justify-content:center; margin-bottom:6px; }
.avatar{ width:100px; height:100px; border-radius:50%; object-fit:cover; border:2px solid var(--panel-border); }

/* ---------- Map bobbing (very light) ---------- */
.building{ transition: transform .2s ease, filter .2s ease; transform-origin: 50% 50%; }
@keyframes bob{
  0% { transform: translateY(0); }
  50%{ transform: translateY(-0.5px); }
  100%{transform: translateY(0); }
}
.building.selected{ animation: bob 1.2s ease-in-out infinite; }

/* ---------- Modal ---------- */
.modal{
  position:fixed; inset:0; z-index:50;
  display:flex; align-items:center; justify-content:center;
  background: rgba(0,0,0,.25);
}
.modalBody{
  width:min(900px, 92vw);
  max-height: 80vh; overflow:auto; -webkit-overflow-scrolling: touch;
  padding:10px; border-radius: var(--radius);
}
.widgetPicker{
  display:grid; grid-template-columns: repeat(auto-fill, minmax(160px,1fr)); gap:10px; margin-top:10px;
}
.pickBtn{ padding:10px; cursor:pointer; }

/* ---------- Tables ---------- */
.table{ width:100%; border-collapse: collapse; }
.table th, .table td{ padding:8px; border-bottom: 1px solid var(--panel-border); text-align:left; }
.table tr:hover{ background: rgba(0,0,0,.03); }
:root.dark .table tr:hover{ background: rgba(255,255,255,.05); }

/* ---------- Footer ---------- */
.footer{ padding-bottom: calc(env(safe-area-inset-bottom) + 10px); }
/* Sidebar width: exactly one icon + text */
:root{ --sidebar-w: 180px; }

/* Sidebar items: icon + label only (no extra symbol) */
.sidebarNav .nav .navItem{
  display:grid;
  grid-template-columns: 26px 1fr; /* icon | label */
}

/* Widgets: compact height & sizes */
.widgetsGrid{ display:grid; gap:10px; grid-template-columns: repeat(12, minmax(0,1fr)); }
.widget-size-s{ grid-column: span 6; }
.widget-size-l{ grid-column: span 12; }
.widgetBody{ padding: 34px 10px 10px; } /* slightly tighter */

/* 6-dot drag handle */
.dragHandle6{
  appearance:none; border:1px dashed var(--panel-border);
  background: transparent; color: var(--muted);
  border-radius: 8px; padding: 2px 6px; cursor:grab; font-weight:700;
}
.dragHandle6:active{ cursor:grabbing; }

/* Sticky note styles */
.stickyNote{ position:relative; }
.stickyPin{ position:absolute; top:-6px; left:10px; transform: rotate(-12deg); filter: drop-shadow(0 2px 2px rgba(0,0,0,.2)); }
.stickyPaper{
  padding:10px; border-radius: 10px;
  box-shadow: 0 8px 16px rgba(0,0,0,.08);
  transform: rotate(-1.2deg);
}
.sticky-yellow .stickyPaper{ background: #fff7ad; color:#3a2f00; }
.sticky-mint   .stickyPaper{ background: #c9ffe0; color:#083a2a; }

/* Fine grid (during drag) stays inside area */
.fineGrid{
  position:absolute; inset:0; border-radius: 12px;
  background-image:
    linear-gradient(to right, rgba(0,0,0,.07) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(0,0,0,.07) 1px, transparent 1px);
  background-size: 14px 14px, 14px 14px;
  pointer-events:none;
}

/* Ultra-light pulse only on the chosen widget */
@keyframes pulseZ {
  0%   { transform: perspective(800px) translateZ(0) scale(1); }
  50%  { transform: perspective(800px) translateZ(10px) scale(1.003); }
  100% { transform: perspective(800px) translateZ(0) scale(1); }
}
.draggingPulseSoft{ animation: pulseZ 1300ms ease-in-out infinite; }
/* Optional: ultra-compact widget body */
.widgetBody{ padding: 30px 8px 8px; }
/* Sidebar wide enough for 1 icon + label */
:root{ --sidebar-w: 190px; }

/* Sidebar: exactly two cells: icon | label */
.sidebarNav .nav .navItem{
  display:grid;
  grid-template-columns: 28px 1fr; /* icon | label */
  align-items:center; gap:8px;
}

/* Compact overall type & paddings for “one screen” */
body{ font-size: 14px; }
.topbar{ padding: 6px 10px; }
.card{ padding:8px; }
.btn{ min-height: 38px; padding: 5px 9px; }
.input{ min-height: 36px; padding: 5px 8px; }

/* Widgets grid: 12 cols; small=3 (4 per row), large=6 (2 per row) */
.widgetsGrid{
  display:grid; gap:8px;
  grid-template-columns: repeat(12, minmax(0,1fr));
}
.widget-size-s{ grid-column: span 3; }
.widget-size-l{ grid-column: span 6; }

/* Lower card height so 2 rows fit comfortably */
.widgetBody{ padding: 30px 8px 8px; }

/* Optional: hard height caps for uniform rows (tweak as needed) */
.widgetWrap{ min-height: 150px; }
.widget-size-s .widgetWrap, .widget-size-s{ min-height: 150px; }
.widget-size-l{ min-height: 160px; }

/* 6-dot drag handle only starts drag */
.dragHandle6{
  appearance:none; border:1px dashed var(--panel-border);
  background: transparent; color: var(--muted);
  border-radius: 8px; padding: 2px 6px; cursor:grab; font-weight:700;
}
.dragHandle6:active{ cursor:grabbing; }

/* Fine grid overlay inside widgets area only */
.fineGrid{
  position:absolute; inset:0; border-radius: 12px;
  background-image:
    linear-gradient(to right, rgba(0,0,0,.06) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(0,0,0,.06) 1px, transparent 1px);
  background-size: 12px 12px, 12px 12px;
  pointer-events:none;
}

/* Ultra-light pulse on chosen widget only */
@keyframes pulseZ {
  0%   { transform: perspective(800px) translateZ(0) scale(1); }
  50%  { transform: perspective(800px) translateZ(8px) scale(1.002); }
  100% { transform: perspective(800px) translateZ(0) scale(1); }
}
.draggingPulseSoft{ animation: pulseZ 1300ms ease-in-out infinite; }

/* Sticky note visuals */
.stickyNote{ position:relative; }
.stickyPin{ position:absolute; top:-6px; left:10px; transform: rotate(-12deg); filter: drop-shadow(0 2px 2px rgba(0,0,0,.2)); }
.stickyPaper{
  padding:8px; border-radius: 10px;
  box-shadow: 0 6px 12px rgba(0,0,0,.08);
  transform: rotate(-1deg);
}
.sticky-yellow .stickyPaper{ background:#fff7ad; color:#3a2f00; }
.sticky-mint   .stickyPaper{ background:#c9ffe0; color:#083a2a; }
.noteTitle{ font-weight:700; margin-bottom:4px; }
.noteText{ font-size:.98rem; line-height:1.25; }

/* Make sure content doesn’t scroll vertically by default */
.content{ overflow:hidden; }
/* Compact widget system */
.widgetsGrid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  grid-auto-rows: 120px;   /* much shorter rows */
  gap: 8px;
  padding: 8px;
}

/* Small widget: half width, half height */
.widget-size-s {
  grid-column: span 3;   /* half row */
  grid-row: span 1;      /* 120px tall */
}

/* Large widget: full width, same height */
.widget-size-l {
  grid-column: span 6;   /* full row */
  grid-row: span 1;      /* 120px tall */
}

.widget {
  background: var(--glass);
  border-radius: 8px;
  padding: 10px;
  overflow: hidden;
  position: relative;
  display: flex;
  flex-direction: column;
}

/* Widget header + drag handle */
.widgetHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.85rem;
  margin-bottom: 4px;
}

.widgetBody {
  font-size: 0.8rem;
  flex: 1;
  overflow-y: auto;
}
/* --- header cluster: right side: dropdown → toggle → logout --- */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:8px 12px;
}

.headerRight{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:8px;
  flex-wrap:wrap;           /* wraps neatly if tight */
  min-width: 320px;         /* breathing room so items don't collide */
}

.btn.xs, .input.xs{ white-space: nowrap; }

.headerRight select.input.xs{ max-width: 180px; } /* theme dropdown size */
/* --- compact widget grid: 4 small per row × 2 rows --- */
.widgetsGrid{
  display:grid;
  grid-template-columns: repeat(12, minmax(0,1fr));
  grid-auto-rows: 110px;  /* short rows */
  gap: 6px;
  padding: 6px;
}

/* S = 3 cols (4 per row), L = 6 cols (2 per row) */
.widget-size-s{ grid-column: span 3; grid-row: span 1; }
.widget-size-l{ grid-column: span 6; grid-row: span 1; }

/* tighter internals */
.widgetBody{ padding: 18px 8px 8px; font-size: .9rem; }
.widgetWrap{ min-height: 110px; }
.widgetToolbar{ gap:6px; }
.dragHandle6{ padding: 2px 6px; }
